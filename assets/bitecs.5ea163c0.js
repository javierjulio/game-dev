import"./modulepreload-polyfill.b7f2da20.js";var M={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},G={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},p={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},K={uint8:2**8,uint16:2**16,uint32:2**32},qe=e=>t=>Math.ceil(t/e)*e,$e=qe(4),Xe=Symbol("storeRef"),F=Symbol("storeSize"),He=Symbol("storeMaps"),d=Symbol("storeFlattened"),w=Symbol("storeBase"),Ce=Symbol("storeType"),fe=Symbol("storeArrayElementCounts"),x=Symbol("storeSubarrays"),Y=Symbol("subarrayCursors"),Te=Symbol("subarray"),le=Symbol("subarrayFrom"),he=Symbol("subarrayTo"),me=Symbol("subStore"),ve=Symbol("tagStore"),Z=Symbol("indexType"),ee=Symbol("indexBytes"),Re=Symbol("isEidType"),g={},Ie=(e,t)=>{const n=new ArrayBuffer(t*e.BYTES_PER_ELEMENT),r=new e.constructor(n);return r.set(e,0),r},Je=(e,t)=>{if(ArrayBuffer.isView(e))e[t]=e.slice(0);else{const n=e[me].slice(0);e[t]=e.map((r,a)=>{const s=e[a][le],o=e[a][he];return n.subarray(s,o)})}},we=(e,t,n)=>{const r=e[Y];let a=t[Ce];const s=t[0].length,o=s<=K.uint8?M.ui8:s<=K.uint16?M.ui16:M.ui32;if(r[a]===0){const i=e[fe][a],f=new p[a]($e(i*n));f.set(e[x][a]),e[x][a]=f,f[Z]=G[o],f[ee]=p[o].BYTES_PER_ELEMENT}const u=r[a];let c=0;for(let i=0;i<n;i++){const f=r[a]+i*s,S=f+s;t[i]=e[x][a].subarray(f,S),t[i][le]=f,t[i][he]=S,t[i][Te]=!0,t[i][Z]=G[o],t[i][ee]=p[o].BYTES_PER_ELEMENT,c=S}r[a]=c,t[me]=e[x][a].subarray(u,c)},Pe=(e,t,n)=>{Object.keys(t).forEach(r=>{const a=t[r];Array.isArray(a)?(we(e,a,n),t[d].push(a)):ArrayBuffer.isView(a)?(t[r]=Ie(a,n),t[d].push(t[r])):typeof a=="object"&&Pe(e,t[r],n)})},Be=(e,t)=>{e[ve]||(e[F]=t,e[d].length=0,Object.keys(e[Y]).forEach(n=>{e[Y][n]=0}),Pe(e,e,t))},Ge=(e,t)=>{e[d]&&e[d].forEach(n=>{ArrayBuffer.isView(n)?n[t]=0:n[t].fill(0)})},Ke=(e,t)=>{const n=t*p[e].BYTES_PER_ELEMENT,r=new ArrayBuffer(n),a=new p[e](r);return a[Re]=e===M.eid,a},Ze=(e,t,n)=>{const r=e[F],a=Array(r).fill(0);a[Ce]=t,a[Re]=t===M.eid;const s=e[Y],o=n<=K.uint8?M.ui8:n<=K.uint16?M.ui16:M.ui32;if(!n)throw new Error("bitECS - Must define component array length");if(!p[t])throw new Error(`bitECS - Invalid component array property type ${t}`);if(!e[x][t]){const i=e[fe][t],f=new p[t]($e(i*r));e[x][t]=f,f[Z]=G[o],f[ee]=p[o].BYTES_PER_ELEMENT}const u=s[t];let c=0;for(let i=0;i<r;i++){const f=s[t]+i*n,S=f+n;a[i]=e[x][t].subarray(f,S),a[i][le]=f,a[i][he]=S,a[i][Te]=!0,a[i][Z]=G[o],a[i][ee]=p[o].BYTES_PER_ELEMENT,c=S}return s[t]=c,a[me]=e[x][t].subarray(u,c),a},Me=e=>Array.isArray(e)&&typeof e[0]=="string"&&typeof e[1]=="number",et=(e,t)=>{const n=Symbol("store");if(!e||!Object.keys(e).length)return g[n]={[F]:t,[ve]:!0,[w]:()=>g[n]},g[n];e=JSON.parse(JSON.stringify(e));const r={},a=o=>{const u=Object.keys(o);for(const c of u)Me(o[c])?(r[o[c][0]]||(r[o[c][0]]=0),r[o[c][0]]+=o[c][1]):o[c]instanceof Object&&a(o[c])};a(e);const s={[F]:t,[He]:{},[x]:{},[Xe]:n,[Y]:Object.keys(p).reduce((o,u)=>({...o,[u]:0}),{}),[d]:[],[fe]:r};if(e instanceof Object&&Object.keys(e).length){const o=(u,c)=>{if(typeof u[c]=="string")u[c]=Ke(u[c],t),u[c][w]=()=>g[n],s[d].push(u[c]);else if(Me(u[c])){const[i,f]=u[c];u[c]=Ze(s,i,f),u[c][w]=()=>g[n],s[d].push(u[c])}else u[c]instanceof Object&&(u[c]=Object.keys(u[c]).reduce(o,u[c]));return u};return g[n]=Object.assign(Object.keys(e).reduce(o,e),s),g[n][w]=()=>g[n],g[n]}},N=()=>{const e=[],t=[];e.sort=function(s){const o=Array.prototype.sort.call(this,s);for(let u=0;u<e.length;u++)t[e[u]]=u;return o};const n=s=>e[t[s]]===s;return{add:s=>{n(s)||(t[s]=e.push(s)-1)},remove:s=>{if(!n(s))return;const o=t[s],u=e.pop();u!==s&&(e[o]=u,t[u]=o)},has:n,sparse:t,dense:e}},b=Symbol("entityMasks"),se=Symbol("entityComponents"),R=Symbol("entitySparseSet"),O=Symbol("entityArray"),tt=1e5,ie=0,L=tt,nt=()=>L-L/5,te=()=>L,ce=[],rt=()=>ie,st=new Map,ot=e=>{if(ie>=nt()){const n=L,r=Math.ceil(n/2/4)*4,a=n+r;L=a,dt(a),mt(a),console.info(`\u{1F47E} bitECS - resizing all data stores from ${n} to ${a}`)}const t=ce.length>0?ce.shift():ie++;return e[R].add(t),st.set(t,e),e[Se].forEach(n=>{pe(e,n,t)&&de(n,t)}),e[se].set(t,new Set),t},at=(e,t)=>{if(!!e[R].has(t)){e[oe].forEach(n=>{Ne(e,n,t)}),ce.push(t),e[R].remove(t),e[se].delete(t),e[Ue].delete(e[ye].get(t)),e[ye].delete(t);for(let n=0;n<e[b].length;n++)e[b][n][t]=0}},oe=Symbol("queries"),Se=Symbol("notQueries"),it=Symbol("queryAny"),ct=Symbol("queryAll"),ut=Symbol("queryNone"),ne=Symbol("queryMap"),U=Symbol("$dirtyQueries"),ze=Symbol("queryComponents"),yt=(e,t)=>{const n=[],r=[],a=[];t[ze].forEach(y=>{if(typeof y=="function"){const[v,J]=y();e[A].has(v)||ue(e,v),J==="not"&&r.push(v),J==="changed"&&(a.push(v),n.push(v))}else e[A].has(y)||ue(e,y),n.push(y)});const s=y=>e[A].get(y),o=n.concat(r).map(s),u=N(),c=[],i=[],f=N(),S=N(),$=N(),C=o.map(y=>y.generationId).reduce((y,v)=>(y.includes(v)||y.push(v),y),[]),_=(y,v)=>(y[v.generationId]||(y[v.generationId]=0),y[v.generationId]|=v.bitflag,y),I=n.map(s).reduce(_,{}),q=r.map(s).reduce(_,{}),X=o.reduce(_,{}),z=n.filter(y=>!y[ve]).map(y=>Object.getOwnPropertySymbols(y).includes(d)?y[d]:[y]).reduce((y,v)=>y.concat(v),[]),H=z.map(y=>{const v=Symbol();return Je(y,v),y[v]},[]),E=Object.assign(u,{archetypes:c,changed:i,components:n,notComponents:r,changedComponents:a,allComponents:o,masks:I,notMasks:q,hasMasks:X,generations:C,flatProps:z,toRemove:f,entered:S,exited:$,shadows:H});e[ne].set(t,E),e[oe].add(E),o.forEach(y=>{y.queries.add(E)}),r.length&&e[Se].add(E);for(let y=0;y<rt();y++){if(!e[R].has(y))continue;pe(e,E,y)&&de(E,y)}},ft=(e,t)=>{t&&(e.changed=[]);const{flatProps:n,shadows:r}=e;for(let a=0;a<e.dense.length;a++){const s=e.dense[a];let o=!1;for(let u=0;u<n.length;u++){const c=n[u],i=r[u];if(ArrayBuffer.isView(c[s])){for(let f=0;f<c[s].length;f++)if(c[s][f]!==i[s][f]){o=!0;break}i[s].set(c[s])}else c[s]!==i[s]&&(o=!0,i[s]=c[s])}o&&e.changed.push(s)}return e.changed},be=(...e)=>{let t,n,r,a;if(Array.isArray(e[0])&&(t=e[0]),t===void 0||t[A]!==void 0)return o=>o?o[O]:t[O];const s=function(o,u=!0){o[ne].has(s)||yt(o,s);const c=o[ne].get(s);return ht(o),c.changedComponents.length?ft(c,u):c.dense};return s[ze]=t,s[it]=n,s[ct]=r,s[ut]=a,s},pe=(e,t,n)=>{const{masks:r,notMasks:a,generations:s}=t;for(let o=0;o<s.length;o++){const u=s[o],c=r[u],i=a[u],f=e[b][u][n];if(i&&(f&i)!==0||c&&(f&c)!==c)return!1}return!0},de=(e,t)=>{e.toRemove.remove(t),e.has(t)||e.entered.add(t),e.add(t)},lt=e=>{for(let t=e.toRemove.dense.length-1;t>=0;t--){const n=e.toRemove.dense[t];e.toRemove.remove(n),e.remove(n)}},ht=e=>{!e[U].size||(e[U].forEach(lt),e[U].clear())},Ne=(e,t,n)=>{!t.has(n)||t.toRemove.has(n)||(t.toRemove.add(n),e[U].add(t),t.exited.add(n))},A=Symbol("componentMap"),Oe=[],mt=e=>{Oe.forEach(t=>Be(t,e))},Ee=e=>{const t=et(e,te());return e&&Object.keys(e).length&&Oe.push(t),t},vt=e=>{e[Q]*=2,e[Q]>=2**31&&(e[Q]=1,e[b].push(new Uint32Array(e[j])))},ue=(e,t)=>{if(!t)throw new Error("bitECS - Cannot register null or undefined component");const n=new Set,r=new Set,a=new Set;e[oe].forEach(s=>{s.allComponents.includes(t)&&n.add(s)}),e[A].set(t,{generationId:e[b].length-1,bitflag:e[Q],store:t,queries:n,notQueries:r,changedQueries:a}),t[F]<te()&&Be(t,te()),vt(e)},St=(e,t,n)=>{const r=e[A].get(t);if(!r)return!1;const{generationId:a,bitflag:s}=r;return(e[b][a][n]&s)===s},ae=(e,t,n,r=!0)=>{if(n===void 0)throw new Error("bitECS - entity is undefined.");if(!e[R].has(n))throw new Error("bitECS - entity does not exist in the world.");if(e[A].has(t)||ue(e,t),St(e,t,n))return;const a=e[A].get(t),{generationId:s,bitflag:o,queries:u,notQueries:c}=a;e[b][s][n]|=o,u.forEach(i=>{i.toRemove.has(n)&&i.toRemove.remove(n);const f=pe(e,i,n);f&&de(i,n),f||Ne(e,i,n)}),e[se].get(n).add(t),r&&Ge(t,n)},j=Symbol("size"),bt=Symbol("resizeThreshold"),Q=Symbol("bitflag"),pt=Symbol("archetypes"),Ue=Symbol("localEntities"),ye=Symbol("localEntityLookp"),je=[],dt=e=>{je.forEach(t=>{t[j]=e;for(let n=0;n<t[b].length;n++){const r=t[b][n];t[b][n]=Ie(r,e)}t[bt]=t[j]-t[j]/5})},Et=(e={})=>{const t=e;return gt(t),je.push(t),t},gt=e=>{const t=te();return e[j]=t,e[O]&&e[O].forEach(n=>at(e,n)),e[b]=[new Uint32Array(t)],e[se]=new Map,e[pt]=[],e[R]=N(),e[O]=e[R].dense,e[Q]=1,e[A]=new Map,e[ne]=new Map,e[oe]=new Set,e[Se]=new Set,e[U]=new Set,e[Ue]=new Map,e[ye]=new Map,e},Mt=(...e)=>t=>{let n=t;for(let r=0;r<e.length;r++){const a=e[r];n=a(n)}return n},k=M;const Qe={x:k.f32,y:k.f32,z:k.f32},m=Ee(Qe),l=Ee(Qe),h=Ee({radius:k.f32,color:k.f32}),xt=be([m,l]),At=be([m,l,h]),_t=be([m,l,h]),$t=e=>{const t=_t(e);for(let s=0;s<t.length;s++){const o=t[s],u=t.slice(s+1);for(let c=0;c<u.length;c++){const i=u[c];var n=m.x[o]-m.x[i],r=m.y[o]-m.y[i],a=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));if(a<=h.radius[o]+h.radius[i]){const f=m.x[o]-m.x[i],S=m.y[o]-m.y[i],$=f/a,C=S/a,_=-C,I=$,q=l.x[o]*$+l.y[o]*C,X=l.x[i]*$+l.y[i]*C,z=l.x[o]*_+l.y[o]*I,H=l.x[i]*_+l.y[i]*I,E=(q*(h.radius[o]-h.radius[i])+2*h.radius[i]*X)/(h.radius[o]+h.radius[i]),y=(X*(h.radius[i]-h.radius[o])+2*h.radius[o]*q)/(h.radius[o]+h.radius[i]),v=$*E,J=C*E,Fe=$*y,Ye=C*y,Le=_*z,We=I*z,De=_*H,Ve=I*H;l.x[o]=v+Le,l.y[o]=J+We,l.x[i]=Fe+De,l.y[i]=Ye+Ve}}}return e},Ct=e=>{const t=xt(e);for(let n=0;n<t.length;n++){const r=t[n];m.x[r]+=l.x[r],m.y[r]+=l.y[r],m.z[r]+=l.z[r],m.x[r]-h.radius[r]<0?l.x[r]=Math.abs(l.x[r]):m.x[r]+h.radius[r]>W&&(l.x[r]=-Math.abs(l.x[r])),m.y[r]-h.radius[r]<0?l.y[r]=Math.abs(l.y[r]):m.y[r]+h.radius[r]>D&&(l.y[r]=-Math.abs(l.y[r]))}return e};let T=document.querySelector("canvas"),P=T.getContext("2d"),W=T.width=window.innerWidth,D=T.height=window.innerHeight;window.devicePixelRatio>1&&(T.width=W*window.devicePixelRatio,T.height=D*window.devicePixelRatio,T.style.width=`${W}px`,T.style.height=`${D}px`,P.scale(window.devicePixelRatio,window.devicePixelRatio));const Tt=e=>{const t=At(e);P.clearRect(0,0,W,D);for(let n=0;n<t.length;n++){const r=t[n];P.beginPath(),P.arc(m.x[r],m.y[r],h.radius[r],0,2*Math.PI),P.fillStyle=`hsl(${h.color[r]}, 50%, 50%)`,P.fill()}return e},Rt=e=>{const{time:t}=e,n=performance.now(),r=n-t.then;return t.delta=r,t.elapsed+=r,t.then=n,e},It=Mt(Ct,$t,Tt,Rt),B=Et();B.time={delta:0,elapsed:0,then:performance.now()};const ke=(e,t,n,r,a)=>{const s=ot(B);ae(B,m,s),m.x[s]=e,m.y[s]=t,ae(B,l,s),l.x[s]=n,l.y[s]=r,ae(B,h,s),h.radius[s]=a,h.color[s]=Math.random()*360},Pt=100,Bt=8,V=32,xe=.4,re=[],Ae=V*2,_e=V,zt=D-V,Nt=W-V;for(let e=_e;e<Nt;e+=Ae)for(let t=_e;t<zt;t+=Ae)re.push({x:e,y:t});function Ot(e,t){return Math.random()*(t-e)+e}const Ut=Math.min(Pt,re.length);for(let e=0;e<Ut;e++){const t=Math.floor(Math.random()*re.length),n=re.splice(t,1)[0];ke(n.x,n.y,xe*(2*Math.random()-1),xe*(2*Math.random()-1),Math.floor(Ot(Bt,V)))}window.generateEntity=ke;const ge=()=>{It(B),requestAnimationFrame(ge)};window.run=ge;ge();
