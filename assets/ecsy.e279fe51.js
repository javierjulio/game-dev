var u=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);import"./modulepreload-polyfill.b7f2da20.js";var f=u((exports,module)=>{function getName(s){return s.name}function componentPropertyName(s){return getName(s)}function queryKey(s){for(var e=[],t=0;t<s.length;t++){var n=s[t];if(typeof n=="object"){var o=n.operator==="not"?"!":n.operator;e.push(o+getName(n.Component))}else e.push(getName(n))}return e.sort().join("-")}const hasWindow=typeof window<"u",now=hasWindow&&typeof window.performance<"u"?performance.now.bind(performance):Date.now.bind(Date);class EventDispatcher{constructor(){this._listeners={},this.stats={fired:0,handled:0}}addEventListener(e,t){let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){return this._listeners[e]!==void 0&&this._listeners[e].indexOf(t)!==-1}removeEventListener(e,t){var n=this._listeners[e];if(n!==void 0){var o=n.indexOf(t);o!==-1&&n.splice(o,1)}}dispatchEvent(e,t,n){this.stats.fired++;var o=this._listeners[e];if(o!==void 0)for(var r=o.slice(0),i=0;i<r.length;i++)r[i].call(this,t,n)}resetCounters(){this.stats.fired=this.stats.handled=0}}class Query{constructor(e,t){if(this.Components=[],this.NotComponents=[],e.forEach(r=>{typeof r=="object"?this.NotComponents.push(r.Component):this.Components.push(r)}),this.Components.length===0)throw new Error("Can't create a query without components");this.entities=[],this.eventDispatcher=new EventDispatcher,this.reactive=!1,this.key=queryKey(e);for(var n=0;n<t._entities.length;n++){var o=t._entities[n];this.match(o)&&(o.queries.push(this),this.entities.push(o))}}addEntity(e){e.queries.push(this),this.entities.push(e),this.eventDispatcher.dispatchEvent(Query.prototype.ENTITY_ADDED,e)}removeEntity(e){let t=this.entities.indexOf(e);~t&&(this.entities.splice(t,1),t=e.queries.indexOf(this),e.queries.splice(t,1),this.eventDispatcher.dispatchEvent(Query.prototype.ENTITY_REMOVED,e))}match(e){return e.hasAllComponents(this.Components)&&!e.hasAnyComponents(this.NotComponents)}toJSON(){return{key:this.key,reactive:this.reactive,components:{included:this.Components.map(e=>e.name),not:this.NotComponents.map(e=>e.name)},numEntities:this.entities.length}}stats(){return{numComponents:this.Components.length,numEntities:this.entities.length}}}Query.prototype.ENTITY_ADDED="Query#ENTITY_ADDED";Query.prototype.ENTITY_REMOVED="Query#ENTITY_REMOVED";Query.prototype.COMPONENT_CHANGED="Query#COMPONENT_CHANGED";class System{canExecute(){if(this._mandatoryQueries.length===0)return!0;for(let t=0;t<this._mandatoryQueries.length;t++){var e=this._mandatoryQueries[t];if(e.entities.length===0)return!1}return!0}constructor(e,t){if(this.world=e,this.enabled=!0,this._queries={},this.queries={},this.priority=0,this.executeTime=0,t&&t.priority&&(this.priority=t.priority),this._mandatoryQueries=[],this.initialized=!0,this.constructor.queries)for(var n in this.constructor.queries){var o=this.constructor.queries[n],r=o.components;if(!r||r.length===0)throw new Error("'components' attribute can't be empty in a query");var i=this.world.entityManager.queryComponents(r);this._queries[n]=i,o.mandatory===!0&&this._mandatoryQueries.push(i),this.queries[n]={results:i.entities};var a=["added","removed","changed"];const c={added:Query.prototype.ENTITY_ADDED,removed:Query.prototype.ENTITY_REMOVED,changed:Query.prototype.COMPONENT_CHANGED};o.listen&&a.forEach(l=>{if(this.execute||console.warn(`System '${this.constructor.name}' has defined listen events (${a.join(", ")}) for query '${n}' but it does not implement the 'execute' method.`),o.listen[l]){let p=o.listen[l];if(l==="changed"){if(i.reactive=!0,p===!0){let d=this.queries[n][l]=[];i.eventDispatcher.addEventListener(Query.prototype.COMPONENT_CHANGED,h=>{d.indexOf(h)===-1&&d.push(h)})}else if(Array.isArray(p)){let d=this.queries[n][l]=[];i.eventDispatcher.addEventListener(Query.prototype.COMPONENT_CHANGED,(h,m)=>{p.indexOf(m.constructor)!==-1&&d.indexOf(h)===-1&&d.push(h)})}}else{let d=this.queries[n][l]=[];i.eventDispatcher.addEventListener(c[l],h=>{d.indexOf(h)===-1&&d.push(h)})}}})}}stop(){this.executeTime=0,this.enabled=!1}play(){this.enabled=!0}clearEvents(){for(let t in this.queries){var e=this.queries[t];if(e.added&&(e.added.length=0),e.removed&&(e.removed.length=0),e.changed)if(Array.isArray(e.changed))e.changed.length=0;else for(let n in e.changed)e.changed[n].length=0}}toJSON(){var e={name:this.constructor.name,enabled:this.enabled,executeTime:this.executeTime,priority:this.priority,queries:{}};if(this.constructor.queries){var t=this.constructor.queries;for(let n in t){let o=this.queries[n],r=t[n],i=e.queries[n]={key:this._queries[n].key};i.mandatory=r.mandatory===!0,i.reactive=r.listen&&(r.listen.added===!0||r.listen.removed===!0||r.listen.changed===!0||Array.isArray(r.listen.changed)),i.reactive&&(i.listen={},["added","removed","changed"].forEach(c=>{o[c]&&(i.listen[c]={entities:o[c].length})}))}}return e}}class SystemManager{constructor(e){this._systems=[],this._executeSystems=[],this.world=e,this.lastExecutedSystem=null}registerSystem(e,t){if(!(e.prototype instanceof System))throw new Error(`System '${e.name}' does not extends 'System' class`);if(this.getSystem(e)!==void 0)return console.warn(`System '${e.name}' already registered.`),this;var n=new e(this.world,t);return n.init&&n.init(t),n.order=this._systems.length,this._systems.push(n),n.execute&&(this._executeSystems.push(n),this.sortSystems()),this}unregisterSystem(e){let t=this.getSystem(e);return t===void 0?(console.warn(`Can unregister system '${e.name}'. It doesn't exist.`),this):(this._systems.splice(this._systems.indexOf(t),1),t.execute&&this._executeSystems.splice(this._executeSystems.indexOf(t),1),this)}sortSystems(){this._executeSystems.sort((e,t)=>e.priority-t.priority||e.order-t.order)}getSystem(e){return this._systems.find(t=>t instanceof e)}getSystems(){return this._systems}removeSystem(e){var t=this._systems.indexOf(e);!~t||this._systems.splice(t,1)}executeSystem(e,t,n){if(e.initialized&&e.canExecute()){let o=now();e.execute(t,n),e.executeTime=now()-o,this.lastExecutedSystem=e,e.clearEvents()}}stop(){this._executeSystems.forEach(e=>e.stop())}execute(e,t,n){this._executeSystems.forEach(o=>(n||o.enabled)&&this.executeSystem(o,e,t))}stats(){for(var e={numSystems:this._systems.length,systems:{}},t=0;t<this._systems.length;t++){var n=this._systems[t],o=e.systems[n.constructor.name]={queries:{},executeTime:n.executeTime};for(var r in n.ctx)o.queries[r]=n.ctx[r].stats()}return e}}class ObjectPool{constructor(e,t){this.freeList=[],this.count=0,this.T=e,this.isObjectPool=!0;var n=null;arguments.length>1&&(n=Array.prototype.slice.call(arguments),n.shift()),this.createElement=n?()=>new e(...n):()=>new e,typeof t<"u"&&this.expand(t)}acquire(){this.freeList.length<=0&&this.expand(Math.round(this.count*.2)+1);var e=this.freeList.pop();return e}release(e){e.reset(),this.freeList.push(e)}expand(e){for(var t=0;t<e;t++)this.freeList.push(this.createElement());this.count+=e}totalSize(){return this.count}totalFree(){return this.freeList.length}totalUsed(){return this.count-this.freeList.length}}class QueryManager{constructor(e){this._world=e,this._queries={}}onEntityRemoved(e){for(var t in this._queries){var n=this._queries[t];e.queries.indexOf(n)!==-1&&n.removeEntity(e)}}onEntityComponentAdded(e,t){for(var n in this._queries){var o=this._queries[n];if(!!~o.NotComponents.indexOf(t)&&~o.entities.indexOf(e)){o.removeEntity(e);continue}!~o.Components.indexOf(t)||!o.match(e)||~o.entities.indexOf(e)||o.addEntity(e)}}onEntityComponentRemoved(e,t){for(var n in this._queries){var o=this._queries[n];if(!!~o.NotComponents.indexOf(t)&&!~o.entities.indexOf(e)&&o.match(e)){o.addEntity(e);continue}if(!!~o.Components.indexOf(t)&&!!~o.entities.indexOf(e)&&!o.match(e)){o.removeEntity(e);continue}}}getQuery(e){var t=queryKey(e),n=this._queries[t];return n||(this._queries[t]=n=new Query(e,this._world)),n}stats(){var e={};for(var t in this._queries)e[t]=this._queries[t].stats();return e}}class SystemStateComponent{}SystemStateComponent.isSystemStateComponent=!0;class EntityManager{constructor(e){this.world=e,this.componentsManager=e.componentsManager,this._entities=[],this._entitiesByNames={},this._queryManager=new QueryManager(this),this.eventDispatcher=new EventDispatcher,this._entityPool=new ObjectPool(this.world.options.entityClass,this.world.options.entityPoolSize),this.entitiesWithComponentsToRemove=[],this.entitiesToRemove=[],this.deferredRemovalEnabled=!0}getEntityByName(e){return this._entitiesByNames[e]}createEntity(e){var t=this._entityPool.acquire();return t.alive=!0,t.name=e||"",e&&(this._entitiesByNames[e]?console.warn(`Entity name '${e}' already exist`):this._entitiesByNames[e]=t),t._world=this,this._entities.push(t),this.eventDispatcher.dispatchEvent(ENTITY_CREATED,t),t}entityAddComponent(e,t,n){if(~e._ComponentTypes.indexOf(t)){console.warn("Component type already exists on entity.",e,t.name);return}e._ComponentTypes.push(t),t.__proto__===SystemStateComponent&&e.numStateComponents++;var o=this.world.componentsManager.getComponentsPool(t),r=o.acquire();if(e._components[t.name]=r,n)if(r.copy)r.copy(n);else for(var i in n)r[i]=n[i];this._queryManager.onEntityComponentAdded(e,t),this.world.componentsManager.componentAddedToEntity(t),this.eventDispatcher.dispatchEvent(COMPONENT_ADDED,e,t)}entityRemoveComponent(e,t,n){var o=e._ComponentTypes.indexOf(t);if(!!~o){if(this.eventDispatcher.dispatchEvent(COMPONENT_REMOVE,e,t),n)this._entityRemoveComponentSync(e,t,o);else{e._ComponentTypesToRemove.length===0&&this.entitiesWithComponentsToRemove.push(e),e._ComponentTypes.splice(o,1),e._ComponentTypesToRemove.push(t);var r=getName(t);e._componentsToRemove[r]=e._components[r],delete e._components[r]}this._queryManager.onEntityComponentRemoved(e,t),t.__proto__===SystemStateComponent&&(e.numStateComponents--,e.numStateComponents===0&&!e.alive&&e.remove())}}_entityRemoveComponentSync(e,t,n){e._ComponentTypes.splice(n,1);var o=componentPropertyName(t),r=getName(t),i=e._components[r];delete e._components[r],this.componentsManager._componentPool[o].release(i),this.world.componentsManager.componentRemovedFromEntity(t)}entityRemoveAllComponents(e,t){let n=e._ComponentTypes;for(let o=n.length-1;o>=0;o--)n[o].__proto__!==SystemStateComponent&&this.entityRemoveComponent(e,n[o],t)}removeEntity(e,t){var n=this._entities.indexOf(e);if(!~n)throw new Error("Tried to remove entity not in list");e.alive=!1,e.numStateComponents===0&&(this.eventDispatcher.dispatchEvent(ENTITY_REMOVED,e),this._queryManager.onEntityRemoved(e),t===!0?this._releaseEntity(e,n):this.entitiesToRemove.push(e)),this.entityRemoveAllComponents(e,t)}_releaseEntity(e,t){this._entities.splice(t,1),this._entitiesByNames[e.name]&&delete this._entitiesByNames[e.name],e._world=null,this._entityPool.release(e)}removeAllEntities(){for(var e=this._entities.length-1;e>=0;e--)this.removeEntity(this._entities[e])}processDeferredRemoval(){if(!!this.deferredRemovalEnabled){for(let o=0;o<this.entitiesToRemove.length;o++){let r=this.entitiesToRemove[o],i=this._entities.indexOf(r);this._releaseEntity(r,i)}this.entitiesToRemove.length=0;for(let o=0;o<this.entitiesWithComponentsToRemove.length;o++){let r=this.entitiesWithComponentsToRemove[o];for(;r._ComponentTypesToRemove.length>0;){let i=r._ComponentTypesToRemove.pop();var e=componentPropertyName(i),t=getName(i),n=r._componentsToRemove[t];delete r._componentsToRemove[t],this.componentsManager._componentPool[e].release(n),this.world.componentsManager.componentRemovedFromEntity(i)}}this.entitiesWithComponentsToRemove.length=0}}queryComponents(e){return this._queryManager.getQuery(e)}count(){return this._entities.length}stats(){var e={numEntities:this._entities.length,numQueries:Object.keys(this._queryManager._queries).length,queries:this._queryManager.stats(),numComponentPool:Object.keys(this.componentsManager._componentPool).length,componentPool:{},eventDispatcher:this.eventDispatcher.stats};for(var t in this.componentsManager._componentPool){var n=this.componentsManager._componentPool[t];e.componentPool[t]={used:n.totalUsed(),size:n.count}}return e}}const ENTITY_CREATED="EntityManager#ENTITY_CREATE",ENTITY_REMOVED="EntityManager#ENTITY_REMOVED",COMPONENT_ADDED="EntityManager#COMPONENT_ADDED",COMPONENT_REMOVE="EntityManager#COMPONENT_REMOVE";class DummyObjectPool{constructor(e){this.isDummyObjectPool=!0,this.count=0,this.used=0,this.T=e}acquire(){return this.used++,this.count++,new this.T}release(){this.used--}totalSize(){return this.count}totalFree(){return 1/0}totalUsed(){return this.used}}class ComponentManager{constructor(){this.Components={},this._componentPool={},this.numComponents={}}registerComponent(e){if(this.Components[e.name]){console.warn(`Component type: '${e.name}' already registered.`);return}this.Components[e.name]=e,this.numComponents[e.name]=0}componentAddedToEntity(e){this.Components[e.name]||this.registerComponent(e),this.numComponents[e.name]++}componentRemovedFromEntity(e){this.numComponents[e.name]--}getComponentsPool(e){var t=componentPropertyName(e);return this._componentPool[t]||(e.prototype.reset?this._componentPool[t]=new ObjectPool(e):(console.warn(`Component '${e.name}' won't benefit from pooling because 'reset' method was not implemented.`),this._componentPool[t]=new DummyObjectPool(e))),this._componentPool[t]}}var name="ecsy",version="0.2.5",description="Entity Component System in JS",main="build/ecsy.js",module="build/ecsy.module.js",types="src/index.d.ts",scripts={build:"rollup -c && npm run docs",docs:"rm docs/api/_sidebar.md; typedoc --readme none --mode file --excludeExternals --plugin typedoc-plugin-markdown  --theme docs/theme --hideSources --hideBreadcrumbs --out docs/api/ --includeDeclarations --includes 'src/**/*.d.ts' src; touch docs/api/_sidebar.md","dev:docs":"nodemon -e ts -x 'npm run docs' -w src",dev:"concurrently --names 'ROLLUP,DOCS,HTTP' -c 'bgBlue.bold,bgYellow.bold,bgGreen.bold' 'rollup -c -w -m inline' 'npm run dev:docs' 'npm run dev:server'","dev:server":"http-server -c-1 -p 8080 --cors",lint:"eslint src test examples",start:"npm run dev",test:"ava",travis:"npm run lint && npm run test && npm run build","watch:test":"ava --watch"},repository={type:"git",url:"git+https://github.com/fernandojsg/ecsy.git"},keywords=["ecs","entity component system"],author="Fernando Serrano <fernandojsg@gmail.com> (http://fernandojsg.com)",license="MIT",bugs={url:"https://github.com/fernandojsg/ecsy/issues"},ava={files:["test/**/*.test.js"],sources:["src/**/*.js"],require:["babel-register","esm"]},jspm={files:["package.json","LICENSE","README.md","build/ecsy.js","build/ecsy.min.js","build/ecsy.module.js"],directories:{}},homepage="https://github.com/fernandojsg/ecsy#readme",devDependencies={ava:"^1.4.1","babel-cli":"^6.26.0","babel-core":"^6.26.3","babel-eslint":"^10.0.3","babel-loader":"^8.0.6",concurrently:"^4.1.2","docsify-cli":"^4.4.0",eslint:"^5.16.0","eslint-config-prettier":"^4.3.0","eslint-plugin-prettier":"^3.1.2","http-server":"^0.11.1",nodemon:"^1.19.4",prettier:"^1.19.1",rollup:"^1.29.0","rollup-plugin-json":"^4.0.0","rollup-plugin-terser":"^5.2.0",typedoc:"^0.15.8","typedoc-plugin-markdown":"^2.2.16",typescript:"^3.7.5"},pjson={name,version,description,main,"jsnext:main":"build/ecsy.module.js",module,types,scripts,repository,keywords,author,license,bugs,ava,jspm,homepage,devDependencies};const Version=pjson.version;var nextId=0;class Entity{constructor(e){this._world=e||null,this.id=nextId++,this._ComponentTypes=[],this._components={},this._componentsToRemove={},this.queries=[],this._ComponentTypesToRemove=[],this.alive=!1,this.numStateComponents=0}getComponent(e,t){var n=this._components[e.name];return!n&&t===!0&&(n=this._componentsToRemove[e.name]),n}getRemovedComponent(e){return this._componentsToRemove[e.name]}getComponents(){return this._components}getComponentsToRemove(){return this._componentsToRemove}getComponentTypes(){return this._ComponentTypes}getMutableComponent(e){for(var t=this._components[e.name],n=0;n<this.queries.length;n++){var o=this.queries[n];o.reactive&&o.Components.indexOf(e)!==-1&&o.eventDispatcher.dispatchEvent(Query.prototype.COMPONENT_CHANGED,this,t)}return t}addComponent(e,t){return this._world.entityAddComponent(this,e,t),this}removeComponent(e,t){return this._world.entityRemoveComponent(this,e,t),this}hasComponent(e,t){return!!~this._ComponentTypes.indexOf(e)||t===!0&&this.hasRemovedComponent(e)}hasRemovedComponent(e){return!!~this._ComponentTypesToRemove.indexOf(e)}hasAllComponents(e){for(var t=0;t<e.length;t++)if(!this.hasComponent(e[t]))return!1;return!0}hasAnyComponents(e){for(var t=0;t<e.length;t++)if(this.hasComponent(e[t]))return!0;return!1}removeAllComponents(e){return this._world.entityRemoveAllComponents(this,e)}reset(){this.id=nextId++,this._world=null,this._ComponentTypes.length=0,this.queries.length=0,this._components={}}remove(e){return this._world.removeEntity(this,e)}}const DEFAULT_OPTIONS={entityPoolSize:0,entityClass:Entity};class World{constructor(e={}){if(this.options=Object.assign({},DEFAULT_OPTIONS,e),this.componentsManager=new ComponentManager(this),this.entityManager=new EntityManager(this),this.systemManager=new SystemManager(this),this.enabled=!0,this.eventQueues={},hasWindow&&typeof CustomEvent<"u"){var t=new CustomEvent("ecsy-world-created",{detail:{world:this,version:Version}});window.dispatchEvent(t)}this.lastTime=now()}registerComponent(e){return this.componentsManager.registerComponent(e),this}registerSystem(e,t){return this.systemManager.registerSystem(e,t),this}unregisterSystem(e){return this.systemManager.unregisterSystem(e),this}getSystem(e){return this.systemManager.getSystem(e)}getSystems(){return this.systemManager.getSystems()}execute(e,t){e||(t=now(),e=t-this.lastTime,this.lastTime=t),this.enabled&&(this.systemManager.execute(e,t),this.entityManager.processDeferredRemoval())}stop(){this.enabled=!1}play(){this.enabled=!0}createEntity(e){return this.entityManager.createEntity(e)}stats(){var e={entities:this.entityManager.stats(),system:this.systemManager.stats()};console.log(JSON.stringify(e,null,2))}}class TagComponent{reset(){}}TagComponent.isTagComponent=!0;function createType(s){var e=["create","reset","clear"],t=e.filter(n=>!s[n]);if(t.length>0)throw new Error(`createType expect type definition to implements the following functions: ${t.join(", ")}`);return s.isType=!0,s}var Types={};Types.Number=createType({baseType:Number,isSimpleType:!0,create:s=>typeof s<"u"?s:0,reset:(s,e,t)=>{typeof t<"u"?s[e]=t:s[e]=0},clear:(s,e)=>{s[e]=0}});Types.Boolean=createType({baseType:Boolean,isSimpleType:!0,create:s=>typeof s<"u"?s:!1,reset:(s,e,t)=>{typeof t<"u"?s[e]=t:s[e]=!1},clear:(s,e)=>{s[e]=!1}});Types.String=createType({baseType:String,isSimpleType:!0,create:s=>typeof s<"u"?s:"",reset:(s,e,t)=>{typeof t<"u"?s[e]=t:s[e]=""},clear:(s,e)=>{s[e]=""}});Types.Array=createType({baseType:Array,create:s=>typeof s<"u"?s.slice():[],reset:(s,e,t)=>{typeof t<"u"?s[e]=t.slice():s[e].length=0},clear:(s,e)=>{s[e].length=0},copy:(s,e,t)=>{s[t]=e[t].slice()}});var standardTypes={number:Types.Number,boolean:Types.Boolean,string:Types.String};function inferType(s){return Array.isArray(s)?Types.Array:standardTypes[typeof s]?standardTypes[typeof s]:null}function createComponentClass(s,e){for(let a in s)s[a].type||(s[a].type=inferType(s[a].default));var t=function(){for(let c in s){var a=s[c];let l=a.type;l&&l.isType?this[c]=l.create(a.default):this[c]=a.default}};typeof e<"u"&&Object.defineProperty(t,"name",{value:e}),t.prototype.schema=s;var n=!0;for(let a in s){var o=s[a];o.type||(o.type=inferType(o.default));var r=o.type;r||(console.warn(`Unknown type definition for attribute '${a}'`),n=!1)}if(n){t.prototype.copy=function(a){for(let c in s)if(a[c]){let l=s[c].type;l.isSimpleType?this[c]=a[c]:l.copy?l.copy(this,a,c):console.warn(`Unknown copy function for attribute '${c}' data type`)}},t.prototype.reset=function(){for(let a in s){let c=s[a],l=c.type;l.reset&&l.reset(this,a,c.default)}},t.prototype.clear=function(){for(let a in s){let c=s[a].type;c.clear&&c.clear(this,a)}};for(let a in s){let c=s[a],l=c.type;t.prototype[a]=c.default,l.reset&&l.reset(t.prototype,a,c.default)}}else{console.warn("This component can't use pooling because some data types are not registered. Please provide a type created with 'createType'");for(var i in s){let a=s[i];t.prototype[i]=a.default}}return t}function generateId(s){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=t.length,o=0;o<s;o++)e+=t.charAt(Math.floor(Math.random()*n));return e}function injectScript(s,e){var t=document.createElement("script");t.src=s,t.onload=e,(document.head||document.documentElement).appendChild(t)}function hookConsoleAndErrors(s){var e=["error","warning","log"];e.forEach(t=>{if(typeof console[t]=="function"){var n=console[t].bind(console);console[t]=(...o)=>(s.send({method:"console",type:t,args:JSON.stringify(o)}),n.apply(null,o))}}),window.addEventListener("error",t=>{s.send({method:"error",error:JSON.stringify({message:t.error.message,stack:t.error.stack})})})}function includeRemoteIdHTML(s){let e=document.createElement("div");return e.style.cssText=`
    align-items: center;
    background-color: #333;
    color: #aaa;
    display:flex;
    font-family: Arial;
    font-size: 1.1em;
    height: 40px;
    justify-content: center;
    left: 0;
    opacity: 0.9;
    position: absolute;
    right: 0;
    text-align: center;
    top: 0;
  `,e.innerHTML=`Open ECSY devtools to connect to this page using the code:&nbsp;<b style="color: #fff">${s}</b>&nbsp;<button onClick="generateNewCode()">Generate new code</button>`,document.body.appendChild(e),e}function enableRemoteDevtools(remoteId){if(!hasWindow){console.warn("Remote devtools not available outside the browser");return}window.generateNewCode=()=>{window.localStorage.clear(),remoteId=generateId(6),window.localStorage.setItem("ecsyRemoteId",remoteId),window.location.reload(!1)},remoteId=remoteId||window.localStorage.getItem("ecsyRemoteId"),remoteId||(remoteId=generateId(6),window.localStorage.setItem("ecsyRemoteId",remoteId));let infoDiv=includeRemoteIdHTML(remoteId);window.__ECSY_REMOTE_DEVTOOLS_INJECTED=!0,window.__ECSY_REMOTE_DEVTOOLS={};let Version="",worldsBeforeLoading=[],onWorldCreated=s=>{var e=s.detail.world;Version=s.detail.version,worldsBeforeLoading.push(e)};window.addEventListener("ecsy-world-created",onWorldCreated);let onLoaded=()=>{var peer=new Peer(remoteId);peer.on("open",()=>{peer.on("connection",connection=>{window.__ECSY_REMOTE_DEVTOOLS.connection=connection,connection.on("open",function(){infoDiv.innerHTML="Connected",connection.on("data",function(data){if(data.type==="init"){var script=document.createElement("script");script.setAttribute("type","text/javascript"),script.onload=()=>{script.parentNode.removeChild(script),window.removeEventListener("ecsy-world-created",onWorldCreated),worldsBeforeLoading.forEach(s=>{var e=new CustomEvent("ecsy-world-created",{detail:{world:s,version:Version}});window.dispatchEvent(e)})},script.innerHTML=data.script,(document.head||document.documentElement).appendChild(script),script.onload(),hookConsoleAndErrors(connection)}else if(data.type==="executeScript"){let value=eval(data.script);data.returnEval&&connection.send({method:"evalReturn",value})}})})})})};injectScript("https://cdn.jsdelivr.net/npm/peerjs@0.3.20/dist/peer.min.js",onLoaded)}hasWindow&&new URLSearchParams(window.location.search).has("enable-remote-devtools")&&enableRemoteDevtools();const Position=createComponentClass({x:{default:0},y:{default:0},rotation:{default:0}},"Position"),Motion=createComponentClass({x:{default:0},y:{default:0},angularVelocity:{default:0},damping:{default:0}},"Motion"),NUM_ELEMENTS=4,SPEED_MULTIPLIER=.1,SHAPE_SIZE=20,SHAPE_HALF_SIZE=SHAPE_SIZE/2;let canvas=document.querySelector("canvas"),canvasWidth=canvas.width=window.innerWidth,canvasHeight=canvas.height=window.innerHeight,ctx=canvas.getContext("2d");class Shape{constructor(){this.primitive="box"}}class Renderable extends TagComponent{}class MovableSystem extends System{execute(e,t){this.queries.moving.results.forEach(n=>{var o=n.getComponent(Motion),r=n.getMutableComponent(Position);r.x+=o.x*e,r.y+=o.y*e,r.rotation+=o.angularVelocity*e,console.log(r.rotation,o.angularVelocity),r.x>canvasWidth+SHAPE_HALF_SIZE&&(r.x=-SHAPE_HALF_SIZE),r.x<-SHAPE_HALF_SIZE&&(r.x=canvasWidth+SHAPE_HALF_SIZE),r.y>canvasHeight+SHAPE_HALF_SIZE&&(r.y=-SHAPE_HALF_SIZE),r.y<-SHAPE_HALF_SIZE&&(r.y=canvasHeight+SHAPE_HALF_SIZE)})}}MovableSystem.queries={moving:{components:[Motion,Position]}};class RendererSystem extends System{execute(e,t){ctx.globalAlpha=1,ctx.fillStyle="#ffffff",ctx.fillRect(0,0,canvasWidth,canvasHeight),this.queries.renderables.results.forEach(n=>{var o=n.getComponent(Shape),r=n.getComponent(Position);o.primitive==="box"?this.drawBox(r):this.drawSpaceship(r)})}drawSpaceship(e){ctx.save(),ctx.translate(e.x>>0,e.y>>0),ctx.rotate(e.rotation*180/Math.PI),ctx.strokeStyle="#000",ctx.beginPath(),ctx.moveTo(10,0),ctx.lineTo(-10,-10),ctx.lineTo(-10,10),ctx.lineTo(10,0),ctx.stroke(),ctx.closePath(),ctx.restore()}drawCircle(e){ctx.fillStyle="#888",ctx.beginPath(),ctx.arc(e.x,e.y,SHAPE_HALF_SIZE,0,2*Math.PI,!1),ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#222",ctx.stroke()}drawBox(e){ctx.save(),ctx.beginPath(),ctx.translate(e.x+SHAPE_SIZE/2,e.y+SHAPE_SIZE/2),ctx.rotate(e.rotation*180/Math.PI),ctx.translate(-e.x-SHAPE_SIZE/2,-e.y-SHAPE_SIZE/2),ctx.fillStyle="#f28d89",ctx.rect(e.x-SHAPE_HALF_SIZE,e.y-SHAPE_HALF_SIZE,SHAPE_SIZE,SHAPE_SIZE),ctx.fill(),ctx.lineWidth=1,ctx.strokeStyle="#800904",ctx.stroke(),ctx.closePath(),ctx.restore()}}RendererSystem.queries={renderables:{components:[Renderable,Shape]}};var world=new World;world.registerSystem(MovableSystem).registerSystem(RendererSystem);function getRandomVelocity(){return{x:SPEED_MULTIPLIER*(2*Math.random()-1),y:SPEED_MULTIPLIER*(2*Math.random()-1),angularVelocity:(2*Math.random()-1)*5e-5,damping:0}}function getRandomPosition(){return{x:Math.random()*canvasWidth,y:Math.random()*canvasHeight,rotation:0}}function getRandomShape(){return{primitive:Math.random()>=.5?"circle":"box"}}for(let s=0;s<NUM_ELEMENTS;s++)world.createEntity().addComponent(Motion,getRandomVelocity()).addComponent(Shape,getRandomShape()).addComponent(Position,getRandomPosition()).addComponent(Renderable);function run(){var s=performance.now(),e=s-lastTime;world.execute(e,s),lastTime=s,requestAnimationFrame(run)}var lastTime=performance.now();run()});export default f();
