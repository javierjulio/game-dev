var e,t={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},r={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},n={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},o=256,s=65536,a=(e=4,t=>Math.ceil(t/e)*e),i=Symbol("storeRef"),l=Symbol("storeSize"),c=Symbol("storeMaps"),u=Symbol("storeFlattened"),y=Symbol("storeBase"),d=Symbol("storeType"),f=Symbol("storeArrayElementCounts"),h=Symbol("storeSubarrays"),m=Symbol("subarrayCursors"),b=Symbol("subarray"),p=Symbol("subarrayFrom"),S=Symbol("subarrayTo"),g=Symbol("subStore"),E=Symbol("tagStore"),w=(Symbol("queryShadow"),Symbol("serializeShadow"),Symbol("indexType")),M=Symbol("indexBytes"),A=Symbol("isEidType"),x={},v=(e,t)=>{const r=new ArrayBuffer(t*e.BYTES_PER_ELEMENT),n=new e.constructor(r);return n.set(e,0),n},C=(e,t)=>{if(ArrayBuffer.isView(e))e[t]=e.slice(0);else{const r=e[g].slice(0);e[t]=e.map(((t,n)=>{const o=e[n][p],s=e[n][S];return r.subarray(o,s)}))}},O=(e,i,l)=>{Object.keys(i).forEach((c=>{const y=i[c];Array.isArray(y)?(((e,i,l)=>{const c=e[m];let u=i[d];const y=i[0].length,E=y<=o?t.ui8:y<=s?t.ui16:t.ui32;if(0===c[u]){const t=e[f][u],o=new n[u](a(t*l));o.set(e[h][u]),e[h][u]=o,o[w]=r[E],o[M]=n[E].BYTES_PER_ELEMENT}const A=c[u];let x=0;for(let t=0;t<l;t++){const o=c[u]+t*y,s=o+y;i[t]=e[h][u].subarray(o,s),i[t][p]=o,i[t][S]=s,i[t][b]=!0,i[t][w]=r[E],i[t][M]=n[E].BYTES_PER_ELEMENT,x=s}c[u]=x,i[g]=e[h][u].subarray(A,x)})(e,y,l),i[u].push(y)):ArrayBuffer.isView(y)?(i[c]=v(y,l),i[u].push(i[c])):"object"==typeof y&&O(e,i[c],l)}))},k=(e,t)=>{e[E]||(e[l]=t,e[u].length=0,Object.keys(e[m]).forEach((t=>{e[m][t]=0})),O(e,e,t))},R=(e,t)=>{e[u]&&e[u].forEach((e=>{ArrayBuffer.isView(e)?e[t]=0:e[t].fill(0)}))},T=e=>Array.isArray(e)&&"string"==typeof e[0]&&"number"==typeof e[1],j=(e,v)=>{const C=Symbol("store");if(!e||!Object.keys(e).length)return x[C]={[l]:v,[E]:!0,[y]:()=>x[C]},x[C];e=JSON.parse(JSON.stringify(e));const O={},k=e=>{const t=Object.keys(e);for(const r of t)T(e[r])?(O[e[r][0]]||(O[e[r][0]]=0),O[e[r][0]]+=e[r][1]):e[r]instanceof Object&&k(e[r])};k(e);const R={[l]:v,[c]:{},[h]:{},[i]:C,[m]:Object.keys(n).reduce(((e,t)=>({...e,[t]:0})),{}),[u]:[],[f]:O};if(e instanceof Object&&Object.keys(e).length){const i=(e,c)=>{if("string"==typeof e[c])e[c]=((e,r)=>{const o=r*n[e].BYTES_PER_ELEMENT,s=new ArrayBuffer(o),a=new n[e](s);return a[A]=e===t.eid,a})(e[c],v),e[c][y]=()=>x[C],R[u].push(e[c]);else if(T(e[c])){const[i,E]=e[c];e[c]=((e,i,c)=>{const u=e[l],y=Array(u).fill(0);y[d]=i,y[A]=i===t.eid;const E=e[m],x=c<=o?t.ui8:c<=s?t.ui16:t.ui32;if(!c)throw new Error("bitECS - Must define component array length");if(!n[i])throw new Error(`bitECS - Invalid component array property type ${i}`);if(!e[h][i]){const t=e[f][i],o=new n[i](a(t*u));e[h][i]=o,o[w]=r[x],o[M]=n[x].BYTES_PER_ELEMENT}const v=E[i];let C=0;for(let t=0;t<u;t++){const o=E[i]+t*c,s=o+c;y[t]=e[h][i].subarray(o,s),y[t][p]=o,y[t][S]=s,y[t][b]=!0,y[t][w]=r[x],y[t][M]=n[x].BYTES_PER_ELEMENT,C=s}return E[i]=C,y[g]=e[h][i].subarray(v,C),y})(R,i,E),e[c][y]=()=>x[C],R[u].push(e[c])}else e[c]instanceof Object&&(e[c]=Object.keys(e[c]).reduce(i,e[c]));return e};return x[C]=Object.assign(Object.keys(e).reduce(i,e),R),x[C][y]=()=>x[C],x[C]}},I=()=>{const e=[],t=[];e.sort=function(r){const n=Array.prototype.sort.call(this,r);for(let r=0;r<e.length;r++)t[e[r]]=r;return n};const r=r=>e[t[r]]===r;return{add:n=>{r(n)||(t[n]=e.push(n)-1)},remove:n=>{if(!r(n))return;const o=t[n],s=e.pop();s!==n&&(e[o]=s,t[s]=o)},has:r,sparse:t,dense:e}},B=e=>t=>!e(t),q=e=>e[u],U=q,_=(B(U),e=>"function"==typeof e),P=(B(_),new Map,Symbol("entityMasks")),z=Symbol("entityComponents"),N=Symbol("entitySparseSet"),F=Symbol("entityArray"),L=(Symbol("entityIndices"),Symbol("removedEntities"),1e5),Q=0,Y=L,$=()=>Y,V=[],J=new Map,H=e=>{if(Q>=Y-Y/5){const e=Y,t=e+4*Math.ceil(e/2/4);Y=t,ve(t),fe(t),!0,console.info(`ðŸ‘¾ bitECS - resizing all data stores from ${e} to ${t}`)}const t=V.length>0?V.shift():Q++;return e[N].add(t),J.set(t,e),e[D].forEach((r=>{ae(e,r,t)&&ie(r,t)})),e[z].set(t,new Set),t};var W=Symbol("queries"),D=Symbol("notQueries"),G=Symbol("queryAny"),K=Symbol("queryAll"),X=Symbol("queryNone"),Z=Symbol("queryMap"),ee=Symbol("$dirtyQueries"),te=Symbol("queryComponents"),re=(Symbol("enterQuery"),Symbol("exitQuery"),(e,t)=>{const r=[],n=[],o=[];t[te].forEach((t=>{if("function"==typeof t){const[s,a]=t();e[ye].has(s)||me(e,s),"not"===a&&n.push(s),"changed"===a&&(o.push(s),r.push(s))}else e[ye].has(t)||me(e,t),r.push(t)}));const s=t=>e[ye].get(t),a=r.concat(n).map(s),i=I(),l=I(),c=I(),y=I(),d=a.map((e=>e.generationId)).reduce(((e,t)=>(e.includes(t)||e.push(t),e)),[]),f=(e,t)=>(e[t.generationId]||(e[t.generationId]=0),e[t.generationId]|=t.bitflag,e),h=r.map(s).reduce(f,{}),m=n.map(s).reduce(f,{}),b=a.reduce(f,{}),p=r.filter((e=>!e[E])).map((e=>Object.getOwnPropertySymbols(e).includes(u)?e[u]:[e])).reduce(((e,t)=>e.concat(t)),[]),S=p.map((e=>{const t=Symbol();return C(e,t),e[t]}),[]),g=Object.assign(i,{archetypes:[],changed:[],components:r,notComponents:n,changedComponents:o,allComponents:a,masks:h,notMasks:m,hasMasks:b,generations:d,flatProps:p,toRemove:l,entered:c,exited:y,shadows:S});e[Z].set(t,g),e[W].add(g),a.forEach((e=>{e.queries.add(g)})),n.length&&e[D].add(g);for(let t=0;t<Q;t++){if(!e[N].has(t))continue;ae(e,g,t)&&ie(g,t)}}),ne=(e,t)=>e.concat(t),oe=e=>t=>t.filter((t=>t.name===e().constructor.name)).reduce(ne),se=(oe((function(...e){return function(){return e}})),oe((function(...e){return function(){return e}})),oe((function(...e){return function(){return e}})),(...e)=>{let t;if(Array.isArray(e[0])&&(t=e[0]),void 0===t||void 0!==t[ye])return e=>e?e[F]:t[F];const r=function(e,t=!0){e[Z].has(r)||re(e,r);const n=e[Z].get(r);return ce(e),n.changedComponents.length?((e,t)=>{t&&(e.changed=[]);const{flatProps:r,shadows:n}=e;for(let t=0;t<e.dense.length;t++){const o=e.dense[t];let s=!1;for(let e=0;e<r.length;e++){const t=r[e],a=n[e];if(ArrayBuffer.isView(t[o])){for(let e=0;e<t[o].length;e++)if(t[o][e]!==a[o][e]){s=!0;break}a[o].set(t[o])}else t[o]!==a[o]&&(s=!0,a[o]=t[o])}s&&e.changed.push(o)}return e.changed})(n,t):n.dense};return r[te]=t,r[G]=undefined,r[K]=undefined,r[X]=undefined,r}),ae=(e,t,r)=>{const{masks:n,notMasks:o,generations:s}=t;for(let t=0;t<s.length;t++){const a=s[t],i=n[a],l=o[a],c=e[P][a][r];if(l&&0!=(c&l))return!1;if(i&&(c&i)!==i)return!1}return!0},ie=(e,t)=>{e.toRemove.remove(t),e.has(t)||e.entered.add(t),e.add(t)},le=e=>{for(let t=e.toRemove.dense.length-1;t>=0;t--){const r=e.toRemove.dense[t];e.toRemove.remove(r),e.remove(r)}},ce=e=>{e[ee].size&&(e[ee].forEach(le),e[ee].clear())},ue=(e,t,r)=>{t.has(r)&&!t.toRemove.has(r)&&(t.toRemove.add(r),e[ee].add(t),t.exited.add(r))},ye=Symbol("componentMap"),de=[],fe=e=>{de.forEach((t=>k(t,e)))},he=e=>{const t=j(e,$());return e&&Object.keys(e).length&&de.push(t),t},me=(e,t)=>{if(!t)throw new Error("bitECS - Cannot register null or undefined component");const r=new Set,n=new Set,o=new Set;e[W].forEach((e=>{e.allComponents.includes(t)&&r.add(e)})),e[ye].set(t,{generationId:e[P].length-1,bitflag:e[Ee],store:t,queries:r,notQueries:n,changedQueries:o}),t[l]<$()&&k(t,$()),(e=>{e[Ee]*=2,e[Ee]>=2**31&&(e[Ee]=1,e[P].push(new Uint32Array(e[Se])))})(e)},be=(e,t,r)=>{const n=e[ye].get(t);if(!n)return!1;const{generationId:o,bitflag:s}=n;return(e[P][o][r]&s)===s},pe=(e,t,r,n=!0)=>{if(void 0===r)throw new Error("bitECS - entity is undefined.");if(!e[N].has(r))throw new Error("bitECS - entity does not exist in the world.");if(e[ye].has(t)||me(e,t),be(e,t,r))return;const o=e[ye].get(t),{generationId:s,bitflag:a,queries:i,notQueries:l}=o;e[P][s][r]|=a,i.forEach((t=>{t.toRemove.has(r)&&t.toRemove.remove(r);const n=ae(e,t,r);n&&ie(t,r),n||ue(e,t,r)})),e[z].get(r).add(t),n&&R(t,r)},Se=Symbol("size"),ge=Symbol("resizeThreshold"),Ee=Symbol("bitflag"),we=Symbol("archetypes"),Me=Symbol("localEntities"),Ae=Symbol("localEntityLookp"),xe=[],ve=e=>{xe.forEach((t=>{t[Se]=e;for(let r=0;r<t[P].length;r++){const n=t[P][r];t[P][r]=v(n,e)}t[ge]=t[Se]-t[Se]/5}))},Ce=e=>{const t=$();return e[Se]=t,e[F]&&e[F].forEach((t=>((e,t)=>{if(e[N].has(t)){e[W].forEach((r=>{ue(e,r,t)})),V.push(t),e[N].remove(t),e[z].delete(t),e[Me].delete(e[Ae].get(t)),e[Ae].delete(t);for(let r=0;r<e[P].length;r++)e[P][r][t]=0}})(e,t))),e[P]=[new Uint32Array(t)],e[z]=new Map,e[we]=[],e[N]=I(),e[F]=e[N].dense,e[Ee]=1,e[ye]=new Map,e[Z]=new Map,e[W]=new Set,e[D]=new Set,e[ee]=new Set,e[Me]=new Map,e[Ae]=new Map,e},Oe=t;const ke={x:Oe.f32,y:Oe.f32,z:Oe.f32},Re=he(ke),Te=he(ke),je=he({radius:Oe.f32,color:Oe.f32}),Ie=se([Re,Te]),Be=se([Re,Te,je]),qe=se([Re,Te,je]);let Ue=document.querySelector("canvas"),_e=Ue.width=window.innerWidth,Pe=Ue.height=window.innerHeight,ze=Ue.getContext("2d");const Ne=((...e)=>t=>{let r=t;for(let t=0;t<e.length;t++){r=(0,e[t])(r)}return r})((e=>{const t=Ie(e);for(let e=0;e<t.length;e++){const r=t[e];Re.x[r]+=Te.x[r],Re.y[r]+=Te.y[r],Re.z[r]+=Te.z[r],(Re.x[r]-je.radius[r]<0||Re.x[r]+je.radius[r]>_e)&&(Te.x[r]*=-1.1),(Re.y[r]-je.radius[r]<0||Re.y[r]+je.radius[r]>Pe)&&(Te.y[r]*=-1.1)}return e}),(e=>{const t=qe(e);for(let e=0;e<t.length;e++){const s=t[e],a=t.slice(e+1);for(let e=0;e<a.length;e++){const t=a[e];var r=Re.x[s]-Re.x[t],n=Re.y[s]-Re.y[t],o=Math.sqrt(Math.pow(r,2)+Math.pow(n,2));if(o<=je.radius[s]+je.radius[t]){const e=(Re.x[s]-Re.x[t])/o,r=(Re.y[s]-Re.y[t])/o,n=-r,a=e,i=Te.x[s]*e+Te.y[s]*r,l=Te.x[t]*e+Te.y[t]*r,c=Te.x[s]*n+Te.y[s]*a,u=Te.x[t]*n+Te.y[t]*a,y=(i*(je.radius[s]-je.radius[t])+2*je.radius[t]*l)/(je.radius[s]+je.radius[t]),d=(l*(je.radius[t]-je.radius[s])+2*je.radius[s]*i)/(je.radius[s]+je.radius[t]),f=e*y,h=r*y,m=e*d,b=r*d,p=n*c,S=a*c,g=n*u,E=a*u;Te.x[s]=f+p,Te.y[s]=h+S,Te.x[t]=m+g,Te.y[t]=b+E}}}return e}),(e=>{const t=Be(e);ze.clearRect(0,0,_e,Pe);for(let e=0;e<t.length;e++){const r=t[e];ze.beginPath(),ze.arc(Re.x[r],Re.y[r],je.radius[r],0,2*Math.PI),ze.fillStyle=`hsl(${je.color[r]}, 50%, 50%)`,ze.fill()}return e}),(e=>{const{time:t}=e,r=performance.now(),n=r-t.then;return t.delta=n,t.elapsed+=n,t.then=r,e})),Fe=((e={})=>{const t=e;return Ce(t),xe.push(t),t})();Fe.time={delta:0,elapsed:0,then:performance.now()};const Le=(e,t,r,n,o)=>{const s=H(Fe);pe(Fe,Re,s),Re.x[s]=e,Re.y[s]=t,pe(Fe,Te,s),Te.x[s]=r,Te.y[s]=n,pe(Fe,je,s),je.radius[s]=o,je.color[s]=360*Math.random()},Qe=[],Ye=Pe-30,$e=_e-30;for(let e=30;e<$e;e+=60)for(let t=30;t<Ye;t+=60)Qe.push({x:e,y:t});const Ve=Math.min(100,Qe.length);for(let e=0;e<Ve;e++){const e=Math.floor(Math.random()*Qe.length),t=Qe.splice(e,1)[0];Le(t.x,t.y,.4*(2*Math.random()-1),.4*(2*Math.random()-1),Math.floor((Je=8,He=30,Math.random()*(He-Je)+Je)))}var Je,He;window.generateEntity=Le;const We=()=>{Ne(Fe),requestAnimationFrame(We)};window.run=We,We();
//# sourceMappingURL=bitecs-circle-collision.a2d8a8fd.js.map
